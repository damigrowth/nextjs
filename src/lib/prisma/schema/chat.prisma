model Chat {
  id            String       @id @default(cuid())
  name          String?
  published     Boolean      @default(true)
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
  creatorId     String
  lastMessageId String?      @unique
  members       ChatMember[]
  creator       Profile      @relation(fields: [creatorId], references: [id])
  lastMessage   Message?     @relation("ChatLastMessage", fields: [lastMessageId], references: [id])
  messages      Message[]    @relation("ChatMessages")

  @@index([creatorId])
  @@index([published, createdAt])
  @@index([lastMessageId])
  @@map("chats")
}

model ChatMember {
  chatId    String
  profileId String
  chat      Chat    @relation(fields: [chatId], references: [id], onDelete: Cascade)
  profile   Profile @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@id([chatId, profileId])
  @@index([profileId])
  @@map("chat_members")
}

model Message {
  id            String        @id @default(cuid())
  content       String
  read          Boolean       @default(false)
  published     Boolean       @default(true)
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  authorId      String
  chatId        String
  lastMessageOf Chat?         @relation("ChatLastMessage")
  readBy        MessageRead[]
  author        Profile       @relation(fields: [authorId], references: [id])
  chat          Chat          @relation("ChatMessages", fields: [chatId], references: [id], onDelete: Cascade)

  @@index([authorId])
  @@index([chatId, createdAt])
  @@map("messages")
}

model MessageRead {
  messageId String
  uid       String
  readAt    DateTime @default(now())
  message   Message  @relation(fields: [messageId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [uid], references: [id], onDelete: Cascade)

  @@id([messageId, uid])
  @@index([uid])
  @@map("message_reads")
}
