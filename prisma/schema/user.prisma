model User {
  id                 String        @id @default(cuid())
  email              String        @unique
  emailVerified      Boolean       @default(false)
  name               String?
  createdAt          DateTime      @default(now())
  updatedAt          DateTime      @updatedAt
  step               String        @default("EMAIL_VERIFICATION")
  confirmed          Boolean       @default(false)
  blocked            Boolean       @default(false)
  username           String?       @unique // Keep in user for auth purposes
  displayName        String?       // Keep in user for auth purposes
  banExpires         DateTime?
  banReason          String?
  banned             Boolean       @default(false)
  role               String        @default("user")
  accounts           Account[]
  media              Media[]
  messagesRead       MessageRead[]
  profile            Profile?
  reviewsGiven       Review[]      @relation("ReviewAuthor")
  sessions           Session[]

  @@index([role])
  @@index([step])
  @@index([confirmed, blocked])
  @@map("users")
}

model Profile {
  id              String       @id @default(cuid())
  uid             String       @unique
  type            String?
  tagline         String?
  description     String?
  website         String?
  experience      Int?
  rate            Int?
  size            String?
  skills          String?
  
  // Fields moved from User table
  username        String?      // Duplicated from User for profile purposes
  displayName     String?      // Duplicated from User for profile purposes
  firstName       String?      // Moved from User
  lastName        String?      // Moved from User
  phone           String?      // Moved from User
  city            String?      // Moved from User
  county          String?      // Moved from User
  zipcode         String?      // Moved from User
  
  verified        Boolean      @default(false)
  featured        Boolean      @default(false)
  rating          Float        @default(0)
  reviewCount     Int          @default(0)
  published       Boolean      @default(false)
  isActive        Boolean      @default(false)
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
  chatMemberships ChatMember[]
  chatsCreated    Chat[]
  image           Media?       @relation("ProfileAvatar")
  portfolio       Media[]      @relation("ProfilePortfolio")
  messagesSent    Message[]
  user            User         @relation(fields: [uid], references: [id], onDelete: Cascade)
  reviewsReceived Review[]     @relation("ReviewReceiver")
  services        Service[]

  @@index([uid])
  @@index([published, featured])
  @@index([verified, rating])
  @@map("profiles")
}

enum UserType {
  USER
  FREELANCER
  COMPANY
}

enum JourneyStep {
  EMAIL_VERIFICATION
  ONBOARDING
  DASHBOARD
}
